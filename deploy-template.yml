# GitHub Actions Workflow Template for resume-web forks
#
# This template shows how to use resume-web as a base with your custom overlay files.
# Copy this to your fork at .github/workflows/deploy.yml and customize as needed.

name: Deploy to Cloudflare Pages

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      upstream_ref:
        description: 'Upstream version (tag, branch, or commit SHA)'
        required: false
        default: 'main'
        type: string

env:
  # Pin upstream version - can be overridden via manual workflow trigger
  UPSTREAM_REF: ${{ inputs.upstream_ref || 'main' }}  # Default: 'main'

  # Optional: Choose a pre-defined theme from themes/ directory
  # Leave empty to use default orange theme or provide your own custom.css
  # Available themes: professional-blue, corporate-green, elegant-purple,
  #                   dark-mode, frnz-retro, geocities-hell, comic-sans-nightmare
  THEME: ''  # Example: 'professional-blue'

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      deployments: write
    steps:
      # 1. Checkout your fork (contains custom files in html/)
      - name: Checkout current repository
        uses: actions/checkout@v4
        with:
          path: overlay

      # 2. Checkout upstream resume-web
      - name: Checkout upstream resume-web
        uses: actions/checkout@v4
        with:
          repository: slauger/resume-web
          ref: ${{ env.UPSTREAM_REF }}
          path: resume-web

      # 3. Apply theme if specified
      - name: Apply theme
        if: env.THEME != ''
        run: |
          if [ -f "resume-web/themes/${{ env.THEME }}.css" ]; then
            echo "ğŸ“¦ Applying theme: ${{ env.THEME }}"
            cp -v "resume-web/themes/${{ env.THEME }}.css" resume-web/html/custom.css
          else
            echo "âš ï¸  Theme '${{ env.THEME }}' not found, skipping"
          fi

      # 4. Copy your custom files (cv.json, profile.jpg, or custom theme)
      # Note: If you have your own themes/custom.css, it will override the THEME variable above
      - name: Copy custom files
        run: |
          echo "Files in overlay/html:"
          ls -la overlay/html/ || echo "No html directory"

          # Copy custom theme if exists (overrides THEME variable)
          if [ -f "overlay/themes/custom.css" ]; then
            echo "ğŸ“¦ Using custom theme from overlay/themes/custom.css"
            cp -v overlay/themes/custom.css resume-web/html/custom.css
          fi

          # Copy all other custom files
          if [ -d "overlay/html" ]; then
            echo "Copying files to resume-web/html/..."
            cp -fv overlay/html/* resume-web/html/ || true
          fi

          echo "Files in resume-web/html after copy:"
          ls -la resume-web/html/

      # 5. Validate cv.json against schema
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install ajv-cli for schema validation
        run: npm install -g ajv-cli

      - name: Validate cv.json against schema
        run: |
          ajv validate -s resume-web/cv-schema.json -d resume-web/html/cv.json --strict=false

      # 6. Deploy to Cloudflare Pages
      - name: Deploy to Cloudflare Pages
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          projectName: ${{ github.event.repository.name }}  # Uses repository name as project name
          directory: resume-web/html
          gitHubToken: ${{ secrets.GITHUB_TOKEN }}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Required Secrets (Settings â†’ Secrets and variables â†’ Actions):
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# - CLOUDFLARE_API_TOKEN: Your Cloudflare API token
# - CLOUDFLARE_ACCOUNT_ID: Your Cloudflare account ID
#
# Get these from: https://dash.cloudflare.com/profile/api-tokens
# Required permissions: "Cloudflare Pages - Edit"
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Pinning Upstream Versions:
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Change the UPSTREAM_REF environment variable at the top of this file:
#
# 1. Use a git tag (recommended for production):
#    UPSTREAM_REF: v1.0.0
#
# 2. Use a commit SHA (recommended for maximum stability):
#    UPSTREAM_REF: a1b2c3d4e5f6789...
#
# 3. Use a branch (auto-updates, not recommended for production):
#    UPSTREAM_REF: main
#
# Find available tags at:
# https://github.com/slauger/resume-web/tags
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Using Themes:
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Option 1: Use a pre-defined theme from upstream
#   Set the THEME environment variable to one of:
#   - professional-blue
#   - corporate-green
#   - elegant-purple
#   - dark-mode
#   - frnz-retro (90s nostalgia)
#   - geocities-hell (WARNING: eye cancer)
#   - comic-sans-nightmare (WARNING: psychological damage)
#
# Option 2: Create your own custom theme (recommended for merge-ability)
#   1. Create themes/custom.css in your fork
#   2. Add your color overrides (see themes/ for examples)
#   3. The workflow will automatically use it
#
# Option 3: Use html/custom.css directly
#   Place custom.css in html/ directory (will override THEME variable)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
